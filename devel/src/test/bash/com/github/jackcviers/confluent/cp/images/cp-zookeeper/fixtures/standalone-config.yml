---
version: '2'
services:
  failing-config:
    image: ${BATS_IMAGE}
    labels:
    - io.confluent.docker.testing=true

  failing-config-ticktime:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
    labels:
    - io.confluent.docker.testing=true

  failing-config-server-id:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_SERVERS: abc:111:111
    labels:
    - io.confluent.docker.testing=true

  default-config:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
    labels:
    - io.confluent.docker.testing=true

  kerberos:
    image: docker.io/jackcviers/cp-kerberos
    environment:
      BOOTSTRAP: 0
    volumes:
    - /mnt/${current_working_directory}/devel/src/test/bash/com/github/jackcviers/confluent/cp/images/cp-zookeeper/fixtures/secrets:/tmp/keytab
    - /dev/urandom:/dev/random
    labels:
    - io.confluent.docker.testing=true

  sasl-config:
    image: ${BATS_IMAGE}
    hostname: sasl-config
    restart: on-failure:3
    environment:
      ZOOKEEPER_TICK_TIME: 2000
      ZOOKEEPER_CLIENT_PORT: 52181
      KAFKA_OPTS: -Djava.security.auth.login.config=/etc/kafka/secrets/config_jaas.conf
        -Djava.security.krb5.conf=/etc/kafka/secrets/config_krb.conf
        -Dzookeeper.authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider
        -Dsun.security.krb5.debug=true
    volumes:
    - /mnt/${current_working_directory}/devel/src/test/bash/com/github/jackcviers/confluent/cp/images/cp-zookeeper/fixtures/secrets:/etc/kafka/secrets
    labels:
    - io.confluent.docker.testing=true

  full-config:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 22181
      ZOOKEEPER_TICK_TIME: 5555
      ZOOKEEPER_INIT_LIMIT: 25
      ZOOKEEPER_SYNC_LIMIT: 20
      ZOOKEEPER_QUORUM_LISTEN_ON_ALL_IPS: 'false'
      ZOOKEEPER_AUTOPURGE_PURGE_INTERVAL: 2
      ZOOKEEPER_AUTOPURGE_SNAP_RETAIN_COUNT: 4
      ZOOKEEPER_LOG4J_LOGGERS: zookeeper.foo.bar=DEBUG
      ZOOKEEPER_LOG4J_ROOT_LOGLEVEL: WARN
      ZOOKEEPER_TOOLS_LOG4J_LOGLEVEL: ERROR
    labels:
    - io.confluent.docker.testing=true

  external-volumes:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_TICK_TIME: 2000
      ZOOKEEPER_CLIENT_PORT: 2181
    volumes:
    - /mnt/${current_working_directory}/build/tmp/zk-config-test/data:/var/lib/zookeeper/data
    - /mnt/${current_working_directory}/build/tmp/zk-config-test/log:/var/lib/zookeeper/log
    labels:
    - io.confluent.docker.testing=true

  random-user:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_TICK_TIME: 2000
      ZOOKEEPER_CLIENT_PORT: 2181
    labels:
    - io.confluent.docker.testing=true

  kitchen-sink:
    image: ${BATS_IMAGE}
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 22181
      ZOOKEEPER_TICK_TIME: 5555
      ZOOKEEPER_INIT_LIMIT: 25
      ZOOKEEPER_SYNC_LIMIT: 20
      ZOOKEEPER_QUORUM_LISTEN_ON_ALL_IPS: 'false'
      ZOOKEEPER_AUTO_PURGE_INTERVAL: 2
      ZOOKEEPER_SNAP_RETAIN_COUNT: 4
    volumes:
    - /mnt/${current_working_directory}/build/tmp/zk-config-kitchen-sink-test/data:/var/lib/zookeeper/data
    - /mnt/${current_working_directory}/build/tmp/zk-config-kitchen-sink-test/log:/var/lib/zookeeper/log
    labels:
    - io.confluent.docker.testing=true
